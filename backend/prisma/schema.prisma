generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
  // directUrl  = env("DATABASE_URL_DIRECT") need to add support for pg bouncer later :)
}

model Node {
  id           Int      @id @default(autoincrement())
  createdAt    DateTime @default(now()) @map("created_at")
  updatedAt    DateTime @updatedAt @map("updated_at")
  raw          String
  title        String?
  type         NodeType
  nodeParents  Edge[]   @relation("child_to_parent")
  nodeChildren Edge[]   @relation("parent_to_child")
  note         Note?
  webPage      WebPage?

  @@index(id)
  @@map("nodes")
}

model Edge {
  id       Int  @id @default(autoincrement())
  parent   Node @relation("parent_to_child", fields: [parentId], references: [id])
  parentId Int  @map("parent_id")
  child    Node @relation("child_to_parent", fields: [childId], references: [id])
  childId  Int  @map("child_id")

  @@unique([parentId, childId])
  @@map("edges")
}

model WebPage {
  id     Int    @id @default(autoincrement())
  url    String
  title  String
  node   Node   @relation(fields: [nodeId], references: [id])
  nodeId Int    @unique @map("node_id")

  @@map("web_pages")
}

model Note {
  id     Int    @id @default(autoincrement())
  raw    String
  title  String
  body   String
  node   Node   @relation(fields: [nodeId], references: [id])
  nodeId Int    @unique @map("node_id")

  @@map("notes")
}

enum NodeType {
  NOTE
  WEB_PAGE
}
